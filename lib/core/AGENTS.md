# lib/core - AGENT GUIDE

## OVERVIEW
Cross-cutting concerns: services, routing, localization, extensions.

## STRUCTURE
```
core/
├── services/
│   ├── terminal_service.dart      # PTY startup abstraction
│   ├── app_logger.dart            # Singleton Logger wrapper
│   ├── crash_log_service.dart     # Error persistence to disk
│   ├── user_config_service.dart   # Config directory paths
│   ├── app_version_service.dart   # Version check + updates
│   └── app_bloc_observer.dart     # BLoC event/transition logging
├── router/
│   ├── app_router.dart            # AutoRoute configuration
│   └── app_router.gr.dart         # GENERATED - do not edit
├── l10n/
│   ├── app_localizations.dart     # GENERATED base class
│   ├── app_localizations_en.dart  # GENERATED
│   └── app_localizations_zh.dart  # GENERATED
├── extensions/
│   └── context_extension.dart     # context.theme, context.t
├── constants/
│   └── assets.dart                # Asset path constants
└── types/
    └── typedefs.dart              # Callback type definitions
```

## WHERE TO LOOK

| Task | File | Notes |
|------|------|-------|
| Add new service | `services/` | Singleton pattern, init in main.dart |
| Add route | `router/app_router.dart` | Run `dart run lean_builder build` |
| Add translation | `assets/l10n/*.arb` | Run `flutter gen-l10n` |
| Add extension | `extensions/context_extension.dart` | On BuildContext |

## CONVENTIONS

### Services
```dart
// Singleton pattern used throughout
class MyService {
  MyService._();
  static final MyService instance = MyService._();
  
  Future<void> init() async { ... }
}
```

### Context Extensions
```dart
// Access anywhere in widget tree
context.theme     // ShadThemeData
context.t         // AppLocalizations
context.colorScheme
context.textTheme
```

### Generated Files (DO NOT EDIT)
- `app_router.gr.dart` - regenerate with `lean_builder`
- `app_localizations*.dart` - regenerate with `flutter gen-l10n`

## ANTI-PATTERNS

| Forbidden | Reason |
|-----------|--------|
| Edit `*.gr.dart` | Auto-generated by lean_builder |
| Edit `app_localizations*.dart` | Auto-generated by flutter gen-l10n |
| Service without singleton | Inconsistent state across app |
| Direct Logger() usage | Use AppLogger.instance.logger |
